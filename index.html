<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì¹´í˜</title>
<style>
body { font-family: sans-serif; text-align: center; padding: 20px; }
button { padding: 10px 16px; margin: 4px; }
table { margin: auto; }
textarea { width: 260px; height: 60px; }
.section { margin-top: 25px; border-top: 1px solid #ccc; padding-top: 15px; }
</style>
</head>
<body>

<h2>â˜• ì£¼ë¬¸í•˜ê¸°</h2>

<select id="table">
  <option>1</option><option>2</option><option>3</option>
  <option>4</option><option>5</option>
</select>

<h3>ë©”ë‰´</h3>
<button onclick="add('ì•„ë©”ë¦¬ì¹´ë…¸',4000)">ì•„ë©”ë¦¬ì¹´ë…¸</button>
<button onclick="add('ë¼ë–¼',4500)">ë¼ë–¼</button>
<button onclick="add('ì¼€ì´í¬',5500)">ì¼€ì´í¬</button>

<h3>ğŸ§º ì¥ë°”êµ¬ë‹ˆ</h3>
<table id="cart"></table>
<h3>í•©ê³„: <span id="total">0</span>ì›</h3>

<h3>ğŸ“ ì£¼ë¬¸ ìš”ì²­ ì‚¬í•­</h3>
<textarea id="orderNote" placeholder="ëœ ë‹¬ê²Œ, ì–¼ìŒ ì ê²Œ"></textarea>
<br><br>
<button onclick="submitOrder()">ì£¼ë¬¸í•˜ê¸°</button>

<!-- =================== -->
<div class="section">
<h2>ğŸ”” ë§ˆì‹œëŠ” ì¤‘ ìš”ì²­</h2>

<br><br>
<textarea id="serviceText" placeholder="ìš”ì²­ ì‚¬í•­"></textarea>
<br>
<button onclick="sendCustomService()">ìš”ì²­ ì‚¬í•­</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCjrPv7idDtgkNtaQNQn9RJY4FNDVl_QZ0",
  databaseURL: "https://cafe-complain-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = firebase.database();
let cart = [];

function add(name, price) {
  const item = cart.find(i => i.name === name);
  item ? item.qty++ : cart.push({ name, price, qty: 1 });
  render();
}

function render() {
  let sum = 0;
  const table = document.getElementById("cart");
  table.innerHTML = "";
  cart.forEach(i => {
    sum += i.price * i.qty;
    table.innerHTML += `<tr><td>${i.name}</td><td>x${i.qty}</td></tr>`;
  });
  document.getElementById("total").innerText = sum;
}

function submitOrder() {
  if (!cart.length) return alert("ë©”ë‰´ë¥¼ ì„ íƒí•˜ì„¸ìš”");

  const total = cart.reduce((s,i)=>s+i.price*i.qty,0);
  db.ref("orders").push({
    table: table.value,
    items: cart,
    note: orderNote.value.trim(),
    total,
    time: new Date().toLocaleTimeString(),
    done: false
  });

  cart = [];
  orderNote.value = "";
  render();
  alert("ì£¼ë¬¸ ì™„ë£Œ");
}

/* ===== ì„œë¹„ìŠ¤ ìš”ì²­ ===== */
function sendService(msg) {
  db.ref("serviceRequests").push({
    table: table.value,
    message: msg,
    time: new Date().toLocaleTimeString(),
    done: false
  });
}

function sendCustomService() {
  const text = serviceText.value.trim();
  if (!text) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”");
  sendService(text);
  serviceText.value = "";
}
</script>

</body>
</html>

