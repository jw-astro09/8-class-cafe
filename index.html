<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>8반 카페</title>
<style>
body { font-family: sans-serif; text-align: center; padding: 20px; }
button { padding: 6px 12px; margin: 2px; }
table { margin: auto; border-collapse: collapse; }
td { padding: 6px 10px; }
textarea { width: 260px; height: 60px; }
.section { margin-top: 25px; border-top: 1px solid #ccc; padding-top: 15px; }
.table-select {
  font-size: 15px;
  padding: 10px 10px;
  margin-bottom: 15px;
}
.qty-btn { width: 28px; }
</style>
</head>
<body>

<h2>주문하기</h2>

<label for="table"><h3><b>테이블 번호</b></h3></label>
<select id="table" class="table-select">
  <option>1</option><option>2</option><option>3</option>
  <option>4</option><option>5</option><option>6</option>
</select>

<h3>메뉴</h3>
<button onclick="add('복숭아 아이스티',1000)">복숭아 아이스티(탄산)</button>
<button onclick="add('청포도 에이드',1000)">청포도 에이드</button>
<button onclick="add('핫 케이크',1000)">핫 케이크</button>

<h3>주문목록</h3>
<table id="cart"></table>
<h3>합계: <span id="total">0</span>원</h3>

<h3>주문 요청 사항</h3>
<textarea id="orderNote" placeholder="진하게, 얼음 적게"></textarea>
<br><br>
<button onclick="submitOrder()">주문하기</button>

<div class="section">
<h2>요청사항</h2>
<textarea id="serviceText" placeholder="요청 사항"></textarea>
<br>
<button onclick="sendCustomService()">요청 사항</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCjrPv7idDtgkNtaQNQn9RJY4FNDVl_QZ0",
  databaseURL: "https://cafe-complain-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = firebase.database();
const MAX_TOTAL = 3000;
let cart = [];

/* 메뉴 추가 */
function add(name, price) {
  const currentTotal = getTotal();
  if (currentTotal + price > MAX_TOTAL) {
    alert("총 주문 금액은 3000원을 넘을 수 없습니다.");
    return;
  }

  const item = cart.find(i => i.name === name);
  item ? item.qty++ : cart.push({ name, price, qty: 1 });
  render();
}

/* 수량 증가 */
function increase(index) {
  const item = cart[index];
  if (getTotal() + item.price > MAX_TOTAL) {
    alert("총 주문 금액은 3000원을 넘을 수 없습니다.");
    return;
  }
  item.qty++;
  render();
}

/* 수량 감소 (0 이하 불가) */
function decrease(index) {
  const item = cart[index];
  item.qty--;
  if (item.qty <= 0) {
    cart.splice(index, 1);
  }
  render();
}

/* 합계 계산 */
function getTotal() {
  return cart.reduce((s, i) => s + i.price * i.qty, 0);
}

/* 장바구니 렌더링 */
function render() {
  const tableEl = document.getElementById("cart");
  tableEl.innerHTML = "";

  cart.forEach((i, index) => {
    tableEl.innerHTML += `
      <tr>
        <td>${i.name}</td>
        <td>
          <button class="qty-btn" onclick="decrease(${index})">-</button>
          ${i.qty}
          <button class="qty-btn" onclick="increase(${index})">+</button>
        </td>
        <td>${i.price * i.qty}원</td>
      </tr>
    `;
  });

  document.getElementById("total").innerText = getTotal();
}

/* 주문 제출 */
function submitOrder() {
  if (!cart.length) return alert("메뉴를 선택하세요");

  const total = getTotal();
  if (total > MAX_TOTAL) return alert("3000원을 초과한 주문은 불가능합니다.");

  db.ref("orders").push({
    table: table.value,
    items: cart,
    note: orderNote.value.trim(),
    total,
    time: new Date().toLocaleTimeString(),
    done: false
  });

  cart = [];
  orderNote.value = "";
  render();
  alert("주문 완료");
}

/* 요청사항 */
function sendService(msg) {
  db.ref("serviceRequests").push({
    table: table.value,
    message: msg,
    time: new Date().toLocaleTimeString(),
    done: false
  });
}

function sendCustomService() {
  const text = serviceText.value.trim();
  if (!text) return alert("내용을 입력하세요");
  sendService(text);
  serviceText.value = "";
}
</script>

</body>
</html>


