<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>카페</title>
<style>
body { font-family: sans-serif; text-align: center; padding: 20px; }
button { padding: 10px 16px; margin: 4px; }
table { margin: auto; }
textarea { width: 260px; height: 60px; }
.section { margin-top: 25px; border-top: 1px solid #ccc; padding-top: 15px; }
</style>
</head>
<body>

<h2>주문하기</h2>

<select id="table">
  <option>1</option><option>2</option><option>3</option>
  <option>4</option><option>5</option>
</select>

<h3>메뉴</h3>
<button onclick="add('복숭아 아이스티',1000)">복숭아 아이스티(탄산)</button>
<button onclick="add('청포도 에이드',1000)">청포도 에이드</button>
<button onclick="add('핫 케이크',2000)">핫 케이크</button>

<h3>주문목록</h3>
<table id="cart"></table>
<h3>합계: <span id="total">0</span>원</h3>

<h3>주문 요청 사항</h3>
<textarea id="orderNote" placeholder="덜 달게, 얼음 적게"></textarea>
<br><br>
<button onclick="submitOrder()">주문하기</button>

<!-- =================== -->
<div class="section">
<h2>마시는 중 요청</h2>

<br><br>
<textarea id="serviceText" placeholder="요청 사항"></textarea>
<br>
<button onclick="sendCustomService()">요청 사항</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCjrPv7idDtgkNtaQNQn9RJY4FNDVl_QZ0",
  databaseURL: "https://cafe-complain-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = firebase.database();
let cart = [];

function add(name, price) {
  const item = cart.find(i => i.name === name);
  item ? item.qty++ : cart.push({ name, price, qty: 1 });
  render();
}

function render() {
  let sum = 0;
  const table = document.getElementById("cart");
  table.innerHTML = "";
  cart.forEach(i => {
    sum += i.price * i.qty;
    table.innerHTML += `<tr><td>${i.name}</td><td>x${i.qty}</td></tr>`;
  });
  document.getElementById("total").innerText = sum;
}

function submitOrder() {
  if (!cart.length) return alert("메뉴를 선택하세요");

  const total = cart.reduce((s,i)=>s+i.price*i.qty,0);
  db.ref("orders").push({
    table: table.value,
    items: cart,
    note: orderNote.value.trim(),
    total,
    time: new Date().toLocaleTimeString(),
    done: false
  });

  cart = [];
  orderNote.value = "";
  render();
  alert("주문 완료");
}

/* ===== 서비스 요청 ===== */
function sendService(msg) {
  db.ref("serviceRequests").push({
    table: table.value,
    message: msg,
    time: new Date().toLocaleTimeString(),
    done: false
  });
}

function sendCustomService() {
  const text = serviceText.value.trim();
  if (!text) return alert("내용을 입력하세요");
  sendService(text);
  serviceText.value = "";
}
</script>

</body>
</html>



